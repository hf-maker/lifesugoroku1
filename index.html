<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>äººç”Ÿã™ã”ã‚ãï¼ˆ65æ­³ã‚´ãƒ¼ãƒ«ï¼‰</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#f0f9ff; padding:20px }
    h1 { font-size:24px }
    #board { display:grid; grid-template-columns: repeat(5, 1fr); gap:8px; max-width:500px; margin-bottom:20px }
    .cell { background:white; border-radius:12px; padding:10px; text-align:center; font-size:13px; min-height:70px; box-shadow:0 2px 4px rgba(0,0,0,0.1) }
    .player { background:#fde68a; border:2px solid #f59e0b; font-weight:bold }
    .event { font-size:11px; margin-top:4px }
    button { padding:12px 20px; border-radius:999px; border:none; background:#2563eb; color:white; font-size:16px; cursor:pointer }
    #log { margin-top:16px; background:white; padding:12px; border-radius:12px; max-width:500px; min-height:60px }
  </style>
</head>
<body>
  <h1>ğŸ² äººç”Ÿã™ã”ã‚ãï¼ˆ65æ­³ã§ã‚´ãƒ¼ãƒ«ï¼‰</h1>
  <p>æ­¢ã¾ã£ãŸãƒã‚¹ã®åŠ¹æœãŒç™ºå‹•ï¼</p>

  <div id="board"></div>
  <button onclick="rollDice()">ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹</button>
  <div id="log"></div>

  <h2>ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</h2>
  <div id="chat" style="background:white; padding:8px; border-radius:8px; max-width:500px; height:120px; overflow-y:auto"></div>
  <input id="name" placeholder="åå‰" style="width:80px" />
  <input id="message" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸" style="width:260px" />
  <button onclick="sendMessage()">é€ä¿¡</button>

  <script type="module">
    // Firebaseè¨­å®šï¼ˆã“ã“ã‚’è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å·®ã—æ›¿ãˆã¦ã­ï¼‰
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, push, onChildAdded } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_DOMAIN",
      databaseURL: "YOUR_DB_URL",
      projectId: "YOUR_PROJECT_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const chatRef = ref(db, 'chat');

    const GOAL = 65;
    const START = 20;
    let age = START;

    const events = {
      22: { text: 'è³‡æ ¼å–å¾—ï¼+2ãƒã‚¹é€²ã‚€', move: 2 },
      25: { text: 'æ˜‡é€²ï¼+1ãƒã‚¹é€²ã‚€', move: 1 },
      28: { text: 'æµªè²»ã—ã™ããŸâ€¦1å›ä¼‘ã¿', skip: 1 },
      30: { text: 'çµå©šï¼ã”ç¥å„€ã§+2ãƒã‚¹', move: 2 },
      35: { text: 'è»¢è·å¤±æ•—â€¦2ãƒã‚¹æˆ»ã‚‹', move: -2 },
      40: { text: 'ãƒã‚¤ãƒ›ãƒ¼ãƒ è³¼å…¥ï¼ãƒ­ãƒ¼ãƒ³ã§1å›ä¼‘ã¿', skip: 1 },
      45: { text: 'å¥åº·è¨ºæ–­ã²ã£ã‹ã‹ã‚‹â€¦1ãƒã‚¹æˆ»ã‚‹', move: -1 },
      50: { text: 'å­ã©ã‚‚ç‹¬ç«‹ï¼+2ãƒã‚¹', move: 2 },
      60: { text: 'å®šå¹´ç›®å‰ã€‚ã‚†ã£ãã‚Šé€²ã‚‚ã†ï¼ˆæ¬¡ã¯å¿…ãš1ï¼‰' }
    };

    let skipTurn = 0;

    function drawBoard() {
      const board = document.getElementById('board');
      board.innerHTML = '';
      for (let i = START; i <= GOAL; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        if (i === age) cell.classList.add('player');
        cell.innerHTML = `<strong>${i}æ­³</strong>`;
        if (events[i]) cell.innerHTML += `<div class="event">${events[i].text}</div>`;
        board.appendChild(cell);
      }
    }

    function rollDice() {
      if (age >= GOAL) return;
      if (skipTurn > 0) {
        skipTurn--;
        log('ğŸ˜´ ä»Šæ—¥ã¯ãŠä¼‘ã¿ã®ç•ªâ€¦');
        return;
      }

      let dice = Math.floor(Math.random() * 6) + 1;
      age += dice;
      log(`ğŸ² ${dice}ãŒå‡ºãŸï¼ ${age}æ­³ã¸`);

      if (events[age]) {
        const e = events[age];
        log('ğŸ‘‰ ' + e.text);
        if (e.move) age += e.move;
        if (e.skip) skipTurn = e.skip;
      }

      if (age >= GOAL) {
        age = GOAL;
        log('ğŸ‰ 65æ­³åˆ°é”ï¼äººç”Ÿã™ã”ã‚ãã‚¯ãƒªã‚¢ï¼');
      }

      drawBoard();

    onChildAdded(chatRef, (snapshot) => {
      const msg = snapshot.val();
      const chat = document.getElementById('chat');
      chat.innerHTML += `<div><strong>${msg.name}</strong>: ${msg.text}</div>`;
      chat.scrollTop = chat.scrollHeight;
    });

    window.sendMessage = function () {
      const name = document.getElementById('name').value || 'åç„¡ã—';
      const text = document.getElementById('message').value;
      if (!text) return;
      push(chatRef, { name, text, time: Date.now() });
      document.getElementById('message').value = '';
    };
    }

    function log(text) {
      const el = document.getElementById('log');
      el.innerHTML += text + '<br>';
    }

    drawBoard();
  </script>
  <hr />
  <h2>ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ã«ã¤ã„ã¦</h2>
  <p>ã“ã®ã‚²ãƒ¼ãƒ ã¯ <strong>Firebase Realtime Database</strong> ã‚’ä½¿ã†ã“ã¨ã§ã€å‹é”ã¨åŒæ™‚ãƒ—ãƒ¬ã‚¤ã§ãã¾ã™ã€‚</p>
  <ol>
    <li>1äººãŒã€Œéƒ¨å±‹ã€ã‚’ä½œæˆ</li>
    <li>URLã‚’å…±æœ‰</li>
    <li>å…¨å“¡ã®ã‚µã‚¤ã‚³ãƒ­çµæœãƒ»ä½ç½®ãŒåŒæœŸ</li>
  </ol>

  <h3>ğŸ§© å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆæ¦‚è¦ï¼‰</h3>
  <pre>
players: {
  player1: { age: 23, skip: 0 },
  player2: { age: 25, skip: 1 }
}
turn: "player1"
  </pre>

  <p>é †ç•ªåˆ¶ã§ã™ã”ã‚ãã‚’å›ã—ã¾ã™ã€‚</p>
</body>
</html>
